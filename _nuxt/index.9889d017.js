import{i as M,s as H,r as i,j as N,k as P,o as r,b as u,u as n,t as p,l as h,e as t,m as F,v as k,p as E,h as b,F as K,q as W}from"./entry.c33d39e7.js";import{C as j,N as q,g as G,a as X,B as z,b as J,p as Q}from"./sync.3121c493.js";import{f as Y}from"./likenft.8e4139ff.js";import{u as Z}from"./wallet.1667cfb1.js";const tt=t("h1",null,"List and Sell NFT",-1),et={key:0,style:{color:"red"}},nt={key:1,style:{color:"green"}},lt=t("hr",null,null,-1),st={key:2},at=t("h2",null,"1. List and Sell NFT",-1),ot=t("p",null,[t("label",null,"Enter default price in LIKE (optional)")],-1),it=t("p",null,[t("label",null,"Enter default expiration of listing (optional)")],-1),rt=["max","min"],ut=t("p",null,[t("label",null,[b("Upload NFT CSV ("),t("a",{href:"https://github.com/likecoin/iscn-nft-tools/blob/master/list-and-sell-nft/list_example.csv",target:"_blank"}," list.csv "),b(") file: ")])],-1),ct={key:0},dt=t("thead",null,[t("tr",null,[t("td",null,"Class ID"),t("td",null,"Count")])],-1),ft=t("br",null,null,-1),gt=["disabled"],pt={key:3},ht={key:0},_t=["href"],mt=["href"],bt=M({__name:"index",setup(vt){const C=Z(),{wallet:_,signer:T}=H(C),{connect:I}=C,S=i(1),m=i(""),v=i(!1),D=i(j),R=i(q),w=i(void 0),x=i(new Date(Date.now()+15552e6).toISOString().split("T")[0]),V=new Date(Date.now()+15552e6).toISOString().split("T")[0],A=new Date(Date.now()).toISOString().split("T")[0],a=i([]),y=i({}),B=N(()=>new Date(x.value).getTime()),O=N(()=>a.value.reduce((l,s)=>(l[s.classId]=(l[s.classId]||0)+1,l),{}));P(v,l=>{l&&(m.value="")});async function U(){try{if(v.value=!0,(!_.value||!T.value)&&await I(),!_.value||!T.value)return;if(!a.value.length)throw new Error("NFT data not exists");for(let e=0;e<a.value.length;e+=1){const{classId:o,nftId:f}=a.value[e],{owner:g}=await G(o,f);if(g!==_.value)throw new Error(`NFT classId: ${o} nftId:${f} is not owned by sender!`)}const s=(await X(T.value)).getSigningStargateClient();if(!s)throw new Error("Signing client not exists");S.value+=1;const c=[];for(let e=0;e<a.value.length;e+=1){const o=a.value[e];if(!(o.price||w.value))throw new Error(`Price not exists for NFT ${e}`);const f=Y(_.value,o.classId,o.nftId,new z(o.price||w.value).shiftedBy(9).toFixed(),new Date(o.expiration).getTime()||B.value);c.push(f)}const d=await s.signAndBroadcast(_.value,c,J(a.value.length));y.value=d}catch(l){console.error(l),m.value=l.toString()}finally{v.value=!1}}function $(l){var e;if(!(l!=null&&l.target))return;const s=(e=l.target)==null?void 0:e.files;if(!s)return;const[c]=s,d=new FileReader;d.onload=o=>{var f;try{const g=(f=o.target)==null?void 0:f.result;if(typeof g!="string")return;const L=Q(g,{columns:!0});a.value=L,y.value=L}catch(g){console.error(g),m.value=g.toString()}},d.readAsText(c)}return(l,s)=>{var c,d;return r(),u("div",null,[tt,n(m)?(r(),u("div",et,p(n(m)),1)):h("",!0),n(v)?(r(),u("div",nt," Loading... ")):h("",!0),t("div",null,"Steps "+p(n(S))+" / 2",1),lt,n(S)===1?(r(),u("section",st,[at,t("div",null,[ot,F(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>E(w)?w.value=e:null),type:"number",placeholder:"0"},null,512),[[k,n(w)]]),it,F(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>E(x)?x.value=e:null),type:"date",max:n(V),min:n(A)},null,8,rt),[[k,n(x)]]),ut,(c=n(a))!=null&&c.length?(r(),u("div",ct,[t("pre",null,"Number of NFT data in CSV:"+p((d=n(a))==null?void 0:d.length),1),b(" Summary "),t("table",null,[dt,t("tbody",null,[(r(!0),u(K,null,W(Object.entries(n(O)),e=>(r(),u("tr",{key:e[0]},[t("td",null,p(e[0]),1),t("td",null,p(e[1]),1)]))),128))])])])):h("",!0),t("input",{type:"file",onChange:$},null,32),ft,t("button",{disabled:n(v),style:{"margin-top":"16px"},onClick:U}," Send ",8,gt)])])):h("",!0),n(S)>1?(r(),u("section",pt,[n(y).transactionHash?(r(),u("p",ht,[b(" Result hash: "),t("a",{href:`${n(D)}/${n(y).transactionHash}`,target:"_blank",rel:"noopener"},p(n(y).transactionHash),9,_t)])):h("",!0),t("a",{href:`${n(R)}/owned`,target:"_blank",rel:"noopener"}," View your Listing ",8,mt)])):h("",!0)])}}});export{bt as default};
