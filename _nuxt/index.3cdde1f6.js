import{F as K,v as Q,z as X,r as b,q as j,l as Y,o as p,b as h,u as g,A as C,B as O,e as s,C as Z,D as ee,E as te,h as E,G as H,H as V}from"./entry.73f5d4ac.js";import{h as q,l as se,i as ae,j as ne,k as re,m as A,t as le,n as oe,p as ie,f as ue,d as fe}from"./sync.b8535657.js";import{u as ce}from"./wallet.473d0bf6.js";var n={},ge=q&&q.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});n.formatMsgSellNFT=n.formatMsgDeleteOffer=n.formatMsgUpdateOffer=n.formatMsgCreateOffer=n.formatMsgBuyNFT=n.formatMsgDeleteListing=n.formatMsgUpdateListing=n.formatMsgCreateListing=n.formatMsgDeleteRoyaltyConfig=n.formatMsgUpdateRoyaltyConfig=n.formatMsgCreateRoyaltyConfig=n.formatMsgBurnNFT=W=n.formatMsgSend=n.formatMsgMintNFT=n.formatMsgUpdateClass=n.formatMsgNewClass=void 0;const T=ge(se),G=K;function de(t,a,e,r){return{typeUrl:"/likechain.likenft.v1.MsgNewClass",value:{creator:t,parent:{type:1,iscnIdPrefix:a},input:{name:e.name,symbol:e.symbol,description:e.description,uri:e.uri,uriHash:e.uriHash,metadata:G.Buffer.from(JSON.stringify(Object.assign({},e.metadata||{})),"utf8"),config:r||{burnable:!1}}}}}n.formatMsgNewClass=de;function me(t,a,e,r){return{typeUrl:"/likechain.likenft.v1.MsgUpdateClass",value:{creator:t,classId:a,input:Object.assign(Object.assign({},e),{config:r||{burnable:!1}})}}}n.formatMsgUpdateClass=me;function ve(t,a,e){return{typeUrl:"/likechain.likenft.v1.MsgMintNFT",value:{creator:t,classId:a,id:e.id,input:{uri:e.uri,uriHash:e.uriHash,metadata:G.Buffer.from(JSON.stringify(Object.assign({},e.metadata||{})),"utf8")}}}}n.formatMsgMintNFT=ve;function pe(t,a,e,r){return{typeUrl:"/cosmos.nft.v1beta1.MsgSend",value:{sender:t,receiver:a,classId:e,id:r}}}var W=n.formatMsgSend=pe;function he(t,a,e){return{typeUrl:"/likechain.likenft.v1.MsgBurnNFT",value:{creator:t,classId:a,nftId:e}}}n.formatMsgBurnNFT=he;function Me(t,a,e){return{typeUrl:"/likechain.likenft.v1.MsgCreateRoyaltyConfig",value:{creator:t,classId:a,royaltyConfig:e}}}n.formatMsgCreateRoyaltyConfig=Me;function ye(t,a,e){return{typeUrl:"/likechain.likenft.v1.MsgUpdateRoyaltyConfig",value:{creator:t,classId:a,royaltyConfig:e}}}n.formatMsgUpdateRoyaltyConfig=ye;function Ce(t,a){return{typeUrl:"/likechain.likenft.v1.MsgDeleteRoyaltyConfig",value:{creator:t,classId:a}}}n.formatMsgDeleteRoyaltyConfig=Ce;function we(t,a,e,r,i){return{typeUrl:"/likechain.likenft.v1.MsgCreateListing",value:{creator:t,classId:a,nftId:e,price:T.default.fromString(r),expiration:i?new Date(i):new Date(Date.now()+15552e3)}}}n.formatMsgCreateListing=we;function _e(t,a,e,r,i){return{typeUrl:"/likechain.likenft.v1.MsgUpdateListing",value:{creator:t,classId:a,nftId:e,price:T.default.fromString(r),expiration:i?new Date(i):new Date(Date.now()+15552e3)}}}n.formatMsgUpdateListing=_e;function ke(t,a,e){return{typeUrl:"/likechain.likenft.v1.MsgDeleteListing",value:{creator:t,classId:a,nftId:e}}}n.formatMsgDeleteListing=ke;function Se(t,a,e,r,i){return{typeUrl:"/likechain.likenft.v1.MsgBuyNFT",value:{creator:t,classId:a,nftId:e,seller:r,price:T.default.fromString(i)}}}n.formatMsgBuyNFT=Se;function Ne(t,a,e,r,i){return{typeUrl:"/likechain.likenft.v1.MsgCreateOffer",value:{creator:t,classId:a,nftId:e,price:T.default.fromString(r),expiration:i?new Date(i):new Date(Date.now()+15552e3)}}}n.formatMsgCreateOffer=Ne;function be(t,a,e,r,i){return{typeUrl:"/likechain.likenft.v1.MsgUpdateOffer",value:{creator:t,classId:a,nftId:e,price:T.default.fromString(r),expiration:i?new Date(i):new Date(Date.now()+15552e3)}}}n.formatMsgUpdateOffer=be;function Te(t,a,e){return{typeUrl:"/likechain.likenft.v1.MsgDeleteOffer",value:{creator:t,classId:a,nftId:e}}}n.formatMsgDeleteOffer=Te;function Fe(t,a,e,r,i){return{typeUrl:"/likechain.likenft.v1.MsgSellNFT",value:{creator:t,classId:a,nftId:e,buyer:r,price:T.default.fromString(i)}}}n.formatMsgSellNFT=Fe;const Ue=s("h1",null,"Send NFT",-1),De={key:0,style:{color:"red"}},Oe={key:1,style:{color:"green"}},Ie=s("hr",null,null,-1),Re={key:2},xe=s("h2",null,"1. Send NFT",-1),Be=s("p",null,[s("label",null,"Enter default memo (optional)")],-1),Le=s("p",null,[s("label",null,"Upload NFT CSV (list.csv) file: ")],-1),$e={key:0},je=s("thead",null,[s("tr",null,[s("td",null,"Class ID"),s("td",null,"Count")])],-1),Ee=s("br",null,null,-1),He=["disabled"],Ve={key:3},qe=s("thead",null,[s("tr",null,[s("td",null,"Address"),s("td",null,"Class ID"),s("td",null,"Memo"),s("td",null,"Status")])],-1),Ae=["disabled"],ze=Q({__name:"index",setup(t){const a=ce(),{wallet:e,signer:r}=X(a),{connect:i}=a,v=b(1),F=b(""),N=b(!1),U=b(""),d=b([]),w=b([]),I=j(()=>d.value.reduce((l,f)=>(l[f.classId]=(l[f.classId]||0)+1,l),{})),R=j(()=>d.value.reduce((l,f)=>(f.nftId&&(l[f.classId]=l[f.classId]||[],l[f.classId].push(f.nftId)),l),{}));Y(N,l=>{l&&(F.value="")});async function J(){try{if(N.value=!0,(!e.value||!r.value)&&await i(),!e.value||!r.value)return;if(!d.value.length)throw new Error("NFT data not exists");const l={};for(let c=0;c<Object.keys(I.value).length;c+=1){const o=Object.keys(I.value)[c],S=I.value[o],{nfts:B}=await ae({classId:o,owner:e.value,needCount:S});if(l[o]=B,S>l[o].length)throw new Error(`NFT classId: ${o} (own quantity: ${l[o].length}), Will send ${S} counts, NFT not enough!`);if(R.value[o]){for(let _=0;_<R.value[o].length;_+=1){const y=R.value[o][_],{owner:$}=await ne(o,y);if($!==e.value)throw new Error(`NFT classId: ${o} nftId:${y} is not owned by sender!`)}l[o]=l[o].filter(_=>!R.value[o].includes(_.id))}}const m=(await re(r.value)).getSigningStargateClient();if(!m)throw new Error("Signing client not exists");const k=d.value.some(c=>c.memo),{accountNumber:u,sequence:L}=await m.getSequence(e.value),x=await m.getChainId();v.value+=1;const M=[];let D=L;for(let c=0;c<d.value.length;c+=1){const o=d.value[c];let S=o.nftId;S||(S=l[o.classId].splice(0,1)[0].id);const B=W(e.value,o.address,o.classId,S);if(k){const _=await m.sign(e.value,[B],A(1),o.memo||U.value,{accountNumber:u,sequence:D,chainId:x});w.value[c].status="signed",D+=1;try{const y=le.TxRaw.encode(_).finish(),$=await m.broadcastTx(y,1e3,1e3);w.value[c].status=`broadcasted ${$.transactionHash}`}catch(y){if(y instanceof oe.TimeoutError)w.value[c].status=`broadcasted ${y.txId}`;else throw w.value[c].status=`error ${y.toString()}`,y}}else M.push(B)}if(M.length){const c=await m.signAndBroadcast(e.value,M,A(d.value.length),U.value);for(let o=0;o<d.value.length;o+=1)w.value[o].status=`broadcasted ${c.transactionHash}`}}catch(l){console.error(l),F.value=l.toString()}finally{N.value=!1}}function z(l){var u;if(!(l!=null&&l.target))return;const f=(u=l.target)==null?void 0:u.files;if(!f)return;const[m]=f,k=new FileReader;k.onload=L=>{var x;try{const M=(x=L.target)==null?void 0:x.result;if(typeof M!="string")return;const D=ie(M,{columns:!0});d.value=D,w.value=D}catch(M){console.error(M),F.value=M.toString()}},k.readAsText(m)}function P(){ue(fe(w.value),"result.csv","text/csv;charset=utf-8;")}return(l,f)=>{var m,k;return p(),h("div",null,[Ue,g(F)?(p(),h("div",De,C(g(F)),1)):O("",!0),g(N)?(p(),h("div",Oe," Loading... ")):O("",!0),s("div",null,"Steps "+C(g(v))+" / 2",1),Ie,g(v)===1?(p(),h("section",Re,[xe,s("div",null,[Be,Z(s("input",{"onUpdate:modelValue":f[0]||(f[0]=u=>te(U)?U.value=u:null),placeholder:"default memo"},null,512),[[ee,g(U)]]),Le,(m=g(d))!=null&&m.length?(p(),h("div",$e,[s("pre",null,"Number of NFT data in CSV:"+C((k=g(d))==null?void 0:k.length),1),E(" Summary "),s("table",null,[je,s("tbody",null,[(p(!0),h(H,null,V(Object.entries(g(I)),u=>(p(),h("tr",{key:u[0]},[s("td",null,C(u[0]),1),s("td",null,C(u[1]),1)]))),128))])])])):O("",!0),s("input",{type:"file",onChange:z},null,32),Ee,s("button",{disabled:g(N),style:{"margin-top":"16px"},onClick:J}," Send ",8,He)])])):O("",!0),g(v)>1?(p(),h("section",Ve,[E(" Result: "),s("table",null,[qe,s("tbody",null,[(p(!0),h(H,null,V(g(w),u=>(p(),h("tr",{key:u[0]},[s("td",null,C(u.address),1),s("td",null,C(u.classId),1),s("td",null,C(u.memo),1),s("td",null,C(u.status),1)]))),128))])]),s("button",{disabled:g(N),onClick:P}," Download NFT result csv ",8,Ae)])):O("",!0)])}}});export{ze as default};
