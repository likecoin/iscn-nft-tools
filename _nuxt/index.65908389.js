import{F as K,v as Q,z as X,r as N,q as j,l as Y,o as M,b as h,u as g,A as C,B as I,e as s,C as Z,D as ee,E as te,h as E,G as H,H as V}from"./entry.621dc897.js";import{h as q,l as se,i as ae,j as ne,k as A,t as re,m as le,p as oe,f as ie,d as ue}from"./sync.315b897a.js";import{u as fe}from"./wallet.031df7b9.js";var n={},ce=q&&q.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});n.formatMsgSellNFT=n.formatMsgDeleteOffer=n.formatMsgUpdateOffer=n.formatMsgCreateOffer=n.formatMsgBuyNFT=n.formatMsgDeleteListing=n.formatMsgUpdateListing=n.formatMsgCreateListing=n.formatMsgDeleteRoyaltyConfig=n.formatMsgUpdateRoyaltyConfig=n.formatMsgCreateRoyaltyConfig=n.formatMsgBurnNFT=W=n.formatMsgSend=n.formatMsgMintNFT=n.formatMsgUpdateClass=n.formatMsgNewClass=void 0;const b=ce(se),G=K;function ge(t,a,e,r){return{typeUrl:"/likechain.likenft.v1.MsgNewClass",value:{creator:t,parent:{type:1,iscnIdPrefix:a},input:{name:e.name,symbol:e.symbol,description:e.description,uri:e.uri,uriHash:e.uriHash,metadata:G.Buffer.from(JSON.stringify(Object.assign({},e.metadata||{})),"utf8"),config:r||{burnable:!1}}}}}n.formatMsgNewClass=ge;function de(t,a,e,r){return{typeUrl:"/likechain.likenft.v1.MsgUpdateClass",value:{creator:t,classId:a,input:Object.assign(Object.assign({},e),{config:r||{burnable:!1}})}}}n.formatMsgUpdateClass=de;function me(t,a,e){return{typeUrl:"/likechain.likenft.v1.MsgMintNFT",value:{creator:t,classId:a,id:e.id,input:{uri:e.uri,uriHash:e.uriHash,metadata:G.Buffer.from(JSON.stringify(Object.assign({},e.metadata||{})),"utf8")}}}}n.formatMsgMintNFT=me;function ve(t,a,e,r){return{typeUrl:"/cosmos.nft.v1beta1.MsgSend",value:{sender:t,receiver:a,classId:e,id:r}}}var W=n.formatMsgSend=ve;function pe(t,a,e){return{typeUrl:"/likechain.likenft.v1.MsgBurnNFT",value:{creator:t,classId:a,nftId:e}}}n.formatMsgBurnNFT=pe;function Me(t,a,e){return{typeUrl:"/likechain.likenft.v1.MsgCreateRoyaltyConfig",value:{creator:t,classId:a,royaltyConfig:e}}}n.formatMsgCreateRoyaltyConfig=Me;function he(t,a,e){return{typeUrl:"/likechain.likenft.v1.MsgUpdateRoyaltyConfig",value:{creator:t,classId:a,royaltyConfig:e}}}n.formatMsgUpdateRoyaltyConfig=he;function ye(t,a){return{typeUrl:"/likechain.likenft.v1.MsgDeleteRoyaltyConfig",value:{creator:t,classId:a}}}n.formatMsgDeleteRoyaltyConfig=ye;function Ce(t,a,e,r,i){return{typeUrl:"/likechain.likenft.v1.MsgCreateListing",value:{creator:t,classId:a,nftId:e,price:b.default.fromString(r),expiration:i?new Date(i):new Date(Date.now()+15552e3)}}}n.formatMsgCreateListing=Ce;function _e(t,a,e,r,i){return{typeUrl:"/likechain.likenft.v1.MsgUpdateListing",value:{creator:t,classId:a,nftId:e,price:b.default.fromString(r),expiration:i?new Date(i):new Date(Date.now()+15552e3)}}}n.formatMsgUpdateListing=_e;function ke(t,a,e){return{typeUrl:"/likechain.likenft.v1.MsgDeleteListing",value:{creator:t,classId:a,nftId:e}}}n.formatMsgDeleteListing=ke;function we(t,a,e,r,i){return{typeUrl:"/likechain.likenft.v1.MsgBuyNFT",value:{creator:t,classId:a,nftId:e,seller:r,price:b.default.fromString(i)}}}n.formatMsgBuyNFT=we;function Se(t,a,e,r,i){return{typeUrl:"/likechain.likenft.v1.MsgCreateOffer",value:{creator:t,classId:a,nftId:e,price:b.default.fromString(r),expiration:i?new Date(i):new Date(Date.now()+15552e3)}}}n.formatMsgCreateOffer=Se;function Ne(t,a,e,r,i){return{typeUrl:"/likechain.likenft.v1.MsgUpdateOffer",value:{creator:t,classId:a,nftId:e,price:b.default.fromString(r),expiration:i?new Date(i):new Date(Date.now()+15552e3)}}}n.formatMsgUpdateOffer=Ne;function be(t,a,e){return{typeUrl:"/likechain.likenft.v1.MsgDeleteOffer",value:{creator:t,classId:a,nftId:e}}}n.formatMsgDeleteOffer=be;function Te(t,a,e,r,i){return{typeUrl:"/likechain.likenft.v1.MsgSellNFT",value:{creator:t,classId:a,nftId:e,buyer:r,price:b.default.fromString(i)}}}n.formatMsgSellNFT=Te;const Ue=s("h1",null,"Send NFT",-1),Fe={key:0,style:{color:"red"}},De={key:1,style:{color:"green"}},Oe=s("hr",null,null,-1),Ie={key:2},Re=s("h2",null,"1. Send NFT",-1),xe=s("p",null,[s("label",null,"Enter default memo (optional)")],-1),Be=s("p",null,[s("label",null,"Upload NFT CSV (list.csv) file: ")],-1),Le={key:0},$e=s("thead",null,[s("tr",null,[s("td",null,"Class ID"),s("td",null,"Count")])],-1),je=s("br",null,null,-1),Ee=["disabled"],He={key:3},Ve=s("thead",null,[s("tr",null,[s("td",null,"Address"),s("td",null,"Class ID"),s("td",null,"Memo"),s("td",null,"Status")])],-1),qe=["disabled"],Je=Q({__name:"index",setup(t){const a=fe(),{wallet:e,signer:r}=X(a),{connect:i}=a,v=N(1),T=N(""),S=N(!1),U=N(""),d=N([]),_=N([]),R=j(()=>d.value.reduce((l,f)=>(l[f.classId]=(l[f.classId]||0)+1,l),{})),B=j(()=>d.value.reduce((l,f)=>(f.nftId&&(l[f.classId]=l[f.classId]||[],l[f.classId].push(f.nftId)),l),{}));Y(S,l=>{l&&(T.value="")});async function J(){try{if(S.value=!0,(!e.value||!r.value)&&await i(),!e.value||!r.value)return;if(!d.value.length)throw new Error("NFT data not exists");const l={};for(let c=0;c<Object.keys(R.value).length;c+=1){const o=Object.keys(R.value)[c],w=R.value[o],{nfts:D}=await ae({classId:o,owner:e.value,needCount:w});if(l[o]=D,w>l[o].length)throw new Error(`NFT classId: ${o} (own quantity: ${l[o].length}), Will send ${w} counts, NFT not enough!`);if(B.value[o]){const O=B.value[o].find(p=>!D.map($=>$.id).includes(p));if(O)throw new Error(`NFT classId: ${o} nftId:${O} is not owned by sender!`);l[o]=l[o].filter(p=>!B.value[o].includes(p.id))}}const m=(await ne(r.value)).getSigningStargateClient();if(!m)throw new Error("Signing client not exists");const k=d.value.some(c=>c.memo),{accountNumber:u,sequence:L}=await m.getSequence(e.value),x=await m.getChainId();v.value+=1;const y=[];let F=L;for(let c=0;c<d.value.length;c+=1){const o=d.value[c];let w=o.nftId;w||(w=l[o.classId].splice(0,1)[0].id);const D=W(e.value,o.address,o.classId,w);if(k){const O=await m.sign(e.value,[D],A(1),o.memo||U.value,{accountNumber:u,sequence:F,chainId:x});_.value[c].status="signed",F+=1;try{const p=re.TxRaw.encode(O).finish(),$=await m.broadcastTx(p,1e3,1e3);_.value[c].status=`broadcasted ${$.transactionHash}`}catch(p){if(p instanceof le.TimeoutError)_.value[c].status=`broadcasted ${p.txId}`;else throw _.value[c].status=`error ${p.toString()}`,p}}else y.push(D)}if(y.length){const c=await m.signAndBroadcast(e.value,y,A(d.value.length),U.value);for(let o=0;o<d.value.length;o+=1)_.value[o].status=`broadcasted ${c.transactionHash}`}}catch(l){console.error(l),T.value=l.toString()}finally{S.value=!1}}function z(l){var u;if(!(l!=null&&l.target))return;const f=(u=l.target)==null?void 0:u.files;if(!f)return;const[m]=f,k=new FileReader;k.onload=L=>{var x;try{const y=(x=L.target)==null?void 0:x.result;if(typeof y!="string")return;const F=oe(y,{columns:!0});d.value=F,_.value=F}catch(y){console.error(y),T.value=y.toString()}},k.readAsText(m)}function P(){ie(ue(_.value),"result.csv","text/csv;charset=utf-8;")}return(l,f)=>{var m,k;return M(),h("div",null,[Ue,g(T)?(M(),h("div",Fe,C(g(T)),1)):I("",!0),g(S)?(M(),h("div",De," Loading... ")):I("",!0),s("div",null,"Steps "+C(g(v))+" / 2",1),Oe,g(v)===1?(M(),h("section",Ie,[Re,s("div",null,[xe,Z(s("input",{"onUpdate:modelValue":f[0]||(f[0]=u=>te(U)?U.value=u:null),placeholder:"default memo"},null,512),[[ee,g(U)]]),Be,(m=g(d))!=null&&m.length?(M(),h("div",Le,[s("pre",null,"Number of NFT data in CSV:"+C((k=g(d))==null?void 0:k.length),1),E(" Summary "),s("table",null,[$e,s("tbody",null,[(M(!0),h(H,null,V(Object.entries(g(R)),u=>(M(),h("tr",{key:u[0]},[s("td",null,C(u[0]),1),s("td",null,C(u[1]),1)]))),128))])])])):I("",!0),s("input",{type:"file",onChange:z},null,32),je,s("button",{disabled:g(S),style:{"margin-top":"16px"},onClick:J}," Send ",8,Ee)])])):I("",!0),g(v)>1?(M(),h("section",He,[E(" Result: "),s("table",null,[Ve,s("tbody",null,[(M(!0),h(H,null,V(g(_),u=>(M(),h("tr",{key:u[0]},[s("td",null,C(u.address),1),s("td",null,C(u.classId),1),s("td",null,C(u.memo),1),s("td",null,C(u.status),1)]))),128))])]),s("button",{disabled:g(S),onClick:P}," Download NFT result csv ",8,qe)])):I("",!0)])}}});export{Je as default};
